<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja-JP">
	<HEAD>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <TITLE>ＤＸライブラリ置き場　脆弱性情報</TITLE>
	<link rel="shortcut icon" href="DxLib.ico">
        <link rel="stylesheet" href="style.css" type="text/css">
	</HEAD>
	<BODY BGCOLOR="#ffffff" TEXT="#000000" LINK="#0033CC" VLINK="#800040">
	<div class="NormalFont">
	<TABLE ALIGN="LEFT" WIDTH=1350  CELLSPACING=0 CELLPADDING=0 >
		<TR>
		<TD ALIGN="LEFT">
		<FONT SIZE="6" COLOR="#000000"><B>
			　　　ＤＸライブラリの脆弱性情報
		</B></FONT>
		</TD></TR>
		<TR><TD>
			<HR>
			<BR>
			<FONT COLOR="#008800"><B>最新バージョン( Ver3.22a )で判明している脆弱性</B><BR><BR></FONT>

			　2020年8月23日時点では最新バージョン( Ver3.22a )で判明している脆弱性はありません。<BR><BR><BR>

			<FONT COLOR="#008800"><B>旧バージョンでの脆弱性</B><BR><BR></FONT>

			<FONT COLOR="#880000"><B>　printfDx の2重に行われる書式指定処理の脆弱性</B><BR><BR></FONT>

			<FONT COLOR="#000088"><B>　　対象バージョン</B><BR><BR></FONT>

			　　　Ver3.13f から Ver3.16b までのバージョン。<BR><BR>

			<FONT COLOR="#000088"><B>　　脆弱性の内容</B><BR><BR></FONT>

			　　　　該当のバージョンでは printfDx で2重に書式指定の処理を行ってしまうというバグが存在します。( 例えば printfDx( "%s", "%d" ); を<BR>
			　　　実行すると、"%s" の部分を "%d" に置き換えた後、更に "%d" を整数値の文字列に置き換えようとします )<BR><BR>

			　　　　また、該当バージョンでは DrawFormatString や printfDx などの書式指定文字列を引数とする関数で、書式指定子 %f や %e で生成される文字列の長さが<BR>
			　　　1023文字を超えるとバッファオーバーフローが発生するというバグも存在します。( そのような状況とは、例えば %.1500f や %.2000e など、<BR>
			　　　有効桁数に 1023 前後以上を指定した場合などです )<BR><BR>

			　　　　このバッファオーバーフローバグを利用した任意のコードの実行には、書式指定子 %e を含んだかなり調整された文字列を「書式指定文字列」<BR>
			　　　として DrawFormatString などの書式指定文字列を引数とする関数に渡す必要があり、一般的にはユーザー入力の文字列を「書式指定文字列」として<BR>
			　　　関数に渡すことは無いので書式指定子 %e のバグを利用した任意のコードの実行は本来は困難なのですが、printfDx の2重に行われる書式指定処理のバグが<BR>
			　　　存在することで「ユーザー入力の文字列を書式指定文字列として処理する」状態が発生し、攻撃が可能となってしまっています。<BR><BR>

			　　　<B>任意のコードを実行するための条件( 1 ～ 3 の全ての条件を満たしている場合、本件の脆弱性を利用した任意のコードの実行ができます )</B><BR><BR>
			　　　　　1.該当バージョンの Unicode版を使用している。<BR><BR>
			　　　　　2.VisualStudio2012以降を使用していない、又は VisualStudio2012以降でコンパイルオプションに /GS- リンカオプションに<BR>
			　　　　　　/DYNAMICBASE:NO /NXCOMPAT:NO /SAFESEH:NO を指定し、各種セキュリティ設定を無効にしている。<BR><BR>
			　　　　　3.DrawFormatString や printfDx などの書式指定文字列を引数とする関数の引数として任意のコードが実行できるように調整された<BR>
			　　　　　　書式指定子 %e を用いた文字列を渡している。<BR><BR>

			<FONT COLOR="#000088"><B>　　脆弱性によって発生しうる影響</B><BR><BR></FONT>

			　　　　任意のコードを実行される可能性があります。<BR><BR>

			<FONT COLOR="#000088"><B>　　脆弱性の影響が発生しうる例</B><BR><BR></FONT>

			　　　　例えばユーザーからの入力( ユーザーが用意するファイルからのデータ読み込み、ネットワーク通信など )で得られた文字列を printfDx の<BR>
			　　　引数として渡している場合、2重に行われてしまう書式指定処理のバグと書式指定子 %e のバッファオーバーフローのバグを利用して<BR>
			　　　任意のコードの実行が行えてしまいます。<BR><BR>

			　　　　但し、ＤＸライブラリの Unicodeバージョンを使用していない場合や、VisualStudio2012以降を使用していて且つセキュリティ設定を<BR>
			　　　無効にしていない場合、又はユーザーが用意したファイルを読み込んで得られた文字列などを printfDx の引数として使用していなければ<BR>
			　　　この脆弱性を利用した任意のコードの実行をすることはできません。<BR><BR>


			<FONT COLOR="#000088"><B>　　脆弱性への対応方法</B><BR><BR></FONT>

			　　　　下記の何れかの方法があります<BR><BR>

			　　　・ＤＸライブラリ Ver3.16d 以降のバージョンを使用する。<BR><BR>
			　　　・VisualStudio2012以降を使用し、且つプロジェクトのセキュリティ設定を無効にしない。<BR><BR>
			　　　・該当バージョンの Unicode版を使用しない。( ＤＸライブラリの一般的な使用方法説明ではマルチバイトバージョンを使用しているので、<BR>
			　　　　意図的に Unicodeバージョンを使用していなければ本件の脆弱性の影響はありません )<BR><BR>
			　　　・該当のバージョンでは printfDx にユーザー入力の文字列を使用しない。<BR><BR>

			<FONT COLOR="#000088"><B>　　JVNに掲載された本件に関する情報へのリンク</B><BR><BR></FONT>
			　　　<A HREF="https://jvn.jp/jp/JVN15205734/">JVN#15205734「ＤＸライブラリにおいて任意のコードが実行可能な脆弱性」</A><BR><BR><BR>

			<FONT COLOR="#000088"><B>　　謝辞</B><BR><BR></FONT>

			　　　　本脆弱性を届出していただいた北川 智也様、ならびに情報提供していただいた IPA様、JPCERT/CC様、ありがとうございます。<BR><BR><BR><BR><BR>



			<FONT COLOR="#880000"><B>　バッファオーバーフローの脆弱性</B><BR><BR></FONT>

			<FONT COLOR="#000088"><B>　　対象バージョン</B><BR><BR></FONT>

			　　　Ver3.15eと、それ以前のバージョン。<BR><BR>

			<FONT COLOR="#000088"><B>　　脆弱性の内容</B><BR><BR></FONT>

			　　　　DrawFormatString や printfDx などの書式指定文字列を引数とする関数で、書式に基づいて生成される文字列の長さが 1023文字( 関数によっては 2047文字 )を<BR>
			　　　超えるとバッファオーバーフローが発生します。<BR>
			　　　　スタック領域に対するメモリの不正なアクセスが発生してしまうので、引数として渡すデータを工夫することで任意のコードが実行できてしまいます。<BR><BR>

			<FONT COLOR="#000088"><B>　　脆弱性によって発生しうる影響</B><BR><BR></FONT>

			　　　　任意のコードを実行される可能性があります。<BR><BR>

			<FONT COLOR="#000088"><B>　　脆弱性の影響が発生しうる例</B><BR><BR></FONT>

			　　　　例えばユーザーからの入力( キーボードからの文字列入力、ユーザーが用意するファイルからのデータ読み込み、ネットワーク通信など )で得られた文字列を<BR>
			　　　DrawFormatString や printfDx などの書式指定文字列を引数とする関数に渡している場合( 且つ、文字列の長さの制限などを行っていない場合、<BR>
			　　　文字列の長さの制限を行っていても DrawFormatString などの関数の中で生成される文字列の長さが 1023文字( 関数によっては 2047文字 )を超える場合 )、<BR>
			　　　バッファオーバーフローを利用した任意のコードの実行が行えてしまいます。<BR><BR>

			　　　　逆にユーザーからのキーボードなどによる文字列入力や、ユーザーが用意したファイルを読み込んで得られた文字列などを最終的に DrawFormatString 等の<BR>
			　　　書式指定文字列を使用する関数で一切使用していなければ、この脆弱性を利用して任意のコードを実行することはできません。<BR><BR>

			<FONT COLOR="#000088"><B>　　脆弱性への対応方法</B><BR><BR></FONT>

			　　　　下記の何れかの方法で脆弱性の影響を回避できます。<BR><BR>

			　　　・ＤＸライブラリ Ver3.16 か、それ以降のバージョンを使用する。<BR><BR>

			　　　・ＤＸライブラリ Ver3.16 より前のバージョンでは、DrawFormatString や printfDx などの書式指定文字列を引数とする関数を使用しない。<BR>
			　　　　( 若しくは書式に基づいて生成される文字列が1023文字を超えないことを保証する処理を追加する )<BR><BR>

			　　　・ＤＸライブラリ Ver3.16 より前のバージョンでは、ユーザー入力の文字列を使用しない。<BR><BR>

			<FONT COLOR="#000088"><B>　　JVNに掲載された本件に関する情報へのリンク</B><BR><BR></FONT>
			　　　<A HREF="https://jvn.jp/jp/JVN49476817/">JVN#49476817「ＤＸライブラリにおけるバッファオーバーフローの脆弱性」</A><BR><BR><BR>

			<FONT COLOR="#000088"><B>　　謝辞</B><BR><BR></FONT>

			　　　　本脆弱性を届出していただいた北川 智也様、ならびに情報提供していただいた IPA様、JPCERT/CC様、ありがとうございます。<BR><BR>

			<HR>
			<A HREF=index.html>戻る</A><BR><BR>
		</B></FONT>
		</TD></TR>
	</TABLE>
	</div>
	</BODY>
</HTML>